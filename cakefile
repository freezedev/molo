flour = require 'flour'
fs = require 'fs'
path = require 'path'
require 'es6-shim'

SOURCE = 'src'
OUTPUT = 'js'
EXAMPLES = 'examples'

task 'build:debug', -> 
  compile "#{SOURCE}/molo.coffee", "#{OUTPUT}/molo.js"

task 'build:production', ->
  compile "#{SOURCE}/molo.coffee", "#{OUTPUT}/molo.js", ->
    minify "#{OUTPUT}/molo.js", "#{OUTPUT}/molo.min.js"

task 'build:examples', ->
  exampleFolderArray = fs.readdirSync("#{EXAMPLES}")

  for i in exampleFolderArray
    fileArray = []
    exampleFolderContent = fs.readdirSync(path.join(EXAMPLES, i))

    fileArray = do -> 
      for j in exampleFolderContent
        if j.endsWith('.coffee') then fileArray.push j else continue

    if fileArray.length > 0 then compile "#{EXAMPLES}/#{i}/*.coffee", "#{EXAMPLES}/#{i}/*"   

task 'build', ->
  invoke 'build:debug'
  invoke 'build:production'
  invoke 'build:examples'